<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.test.mapper.UserMapper">

	<!-- 대원 - 오토맵핑 없어도 <result> 안 써도 동작 되는 이유... --> 
	<resultMap type="UserModel" id="list">
	<!--<result column="name" property="name"/>
		<result column="email" property="email"/>
		<result column="tel" property="tel"/> -->
		<result column="user_no" property="userNo"/> <!-- 대원 - 다른건 없어도 되는데 이건 왜 있어야하는건지? 없으면 userNo가 안 들어옴.... 왜일까  -->
		<collection column="user_no" property="imgList" select="getImg" javaType="java.util.List" ofType="ImgModel" > <!-- 대원 - 사용하는 이유 다시 한번.. association도.. -->
			<!-- <result column="img_no" property="imgNo" />
			<result column="name" property="name" />
			<result column="img_name" property="imgNmae"/> -->
		</collection>
	</resultMap>
	
	<!-- <resultMap type="ImgModel" id="assoTest">
		<result column="name" property="name" />
		<association property=""></association>
	</resultMap> -->
	
	<!-- 리스트 가져오기 -->
	<select id="getList" resultMap="list">
		SELECT *
		FROM user
		WHERE 1=1
		order by user_no desc
	</select>
	
	<!-- JOIN으로 리스트 가져오기 -->
<!-- 	<select id="getList" resultType="UserModel">
		SELECT 
		a.user_no
		, a.email
		, a.name
		, a.tel
		, b.img_name
		FROM user a LEFT JOIN user_img b
		ON a.name = b.name
		order by a.user_no desc
	</select> -->
	
	<!-- imageList 가져오기 -->
	<select id="getImg" resultType="imgModel">
		SELECT *
		FROM user_img
		WHERE 1=1
		AND user_no = #{userNo}
	</select>
	
	<!-- 리스트 추가 -->
	<insert id="insert" parameterType="UserModel">
		INSERT INTO user
		(
		email
		, name
		, tel
		)
		VALUES
		(
		#{email}
		, #{name}
		, #{tel}
		)
	</insert>
	
	<!-- 리스트 이름 클릭시 디테일 -->
	<select id="detail" resultType="UserModel">
		SELECT 
		*
		FROM user
		WHERE 1=1
		AND user_no = #{userNo}
	</select>
	
	<!-- ajax 그냥 테스트 해본거 -->
	<select id="ajaxTest" resultType="String">
		SELECT
		name
		FROM user
		WHERE 1=1
		AND email = #{email}
	</select>
	
	<!-- user 정보 수정 --> 
	<update id="update" parameterType="UserModel">
		UPDATE user
		SET email = #{email}
		, tel = #{tel}
		WHERE 1=1 
		AND user_no = #{userNo}
	</update>
	
	<!-- user 삭제 -->
	<delete id="deleteUser" parameterType="UserModel">   <!-- 대원 - 이렇게 말고 조인해서 삭제하는법...? -->
		DELETE 
		FROM user
		WHERE 1=1
		AND user_no = #{userNo};
		
		DELETE
		FROM user_img
		WHERE 1=1
		AND user_no = #{userNo};
	</delete>
</mapper>